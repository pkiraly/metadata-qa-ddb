format: xml
fields:
  # Identifikator für den Datensatz
  - name: recordId
    path: rdf:RDF/ore:Aggregation/@rdf:about
    extractable: true
    identifierField: true
    indexField: providerItemId
    rules:
      - id: Q-1.1
        description: There must be an ID for the data record in the data record supplied.
        failureScore: -9
        and:
        - minCount: 1
        - minLength: 1
      - id: Q-1.2
        description: The ID for the data record must be unique.
        failureScore: -9
        and:
        - maxCount: 1
        - unique: true
      # - id: Q-1.3
      #   description: In data records that represent several hierarchical levels, the description units of the individual
      #     parts of an object must have a unique identifier within the data record.
      #   failureScore: -9
      # - id: Q-1.4
      #   description: The identifier for the data record must be unchangeable and must not change, especially when updated
      #     data sets are sent to the DDB.
      #   failureScore: -6
      - id: Q-1.5
        description: The ID for the data record is easy to process by machine
        successScore: 3
        pattern: ^[\p{Alpha}\d\.\-&=:/]+$

  # Q-2 Identifikator für den Datengeber
  - name: providerid
    # path: rdf:RDF/ore:Aggregation/edm:dataProvider/@rdf:resource
    path: rdf:RDF/edm:Agent[@rdf:about = string(../ore:Aggregation[1]/edm:dataProvider/@rdf:resource)]/owl:sameAs/@rdf:resource
    extractable: true
    indexField: providerId
    rules:
      - id: Q-2.1
        description: There must be an ID for the data supplier in the data record supplied.
        failureScore: -6
        and:
        - minCount: 1
        - minLength: 1
      - id: Q-2.2
        description: The ID for the data provider must be unique worldwide.
        failureScore: -3
        pattern: ^(DE-\d+|DE-MUS-\d+|http://ld.zdb-services.de/[\w+/-]+|\d{8}|oai\d{13}|http://d-nb.info/gnd/[\w-]+)$
      # - id: Q-2.3
      #   description: The data provider should be identified by an International Standard Identifier for Libraries and Related Organizations (ISIL).
      #   failureScore: -6
      - id: Q-2.4
        description: Check whether the data supplier ID is an ISIL-ID or ISIL-URI using the rules in the table "Data supplier ID"
        successScore: 3
        pattern: ^(DE-\d+|DE-MUS-\d+|http://ld.zdb-services.de/[\w+/-]+)$
      - id: Q-2.5
        description: The data provider should be identified by an http-URI from the ISIL registration.
        successScore: 6
        pattern: ^http://ld.zdb-services.de/[\w+/-]+$
      - id: Q-2.6
        description: The data supplier can be identified by an http-URI from the GND.
        successScore: 3
        pattern: ^http://d-nb.info/gnd/[\w-]+$

  # Q-3	Vorschaubild
  - name: thumbnail
    path: rdf:RDF/ore:Aggregation/edm:object/@rdf:resource
    rules:
      - id: Q-3.0
        hidden: true
        and:
        - minCount: 1
        - minLength: 1
      - id: Q-3.x
        hidden: true
        or:
        - maxCount: 0
        - and:
          - minCount: 1
          - minLength: 1
          - not:
            - pattern: ^[a-zA-Z_0-9:\-]+$
      # no longer carry out the test for criterion Q-3.1-old
      #- id: Q-3.1-old
      #  description: There must be a reference to an image file in the data record provided (either as a link or as a file name).
      #  failureScore: -9
      #  skip: false
      #  or:
      #  - pattern: ^.*\.(jpg|jpeg|jpe|jfif|png|tiff|tif|gif|svg|svgz|pdf)$
      #  - contentType: [image/jpeg, image/png, image/tiff, image/tiff-fx, image/gif, image/svg+xml, application/pdf]
      - id: Q-3.1
        description: The preview image must be explicitly marked if more than one image file is referenced in the data record.
        failureScore: -3
        minCount: 1
        # or one ends with "preview"
      - id: Q-3.2
        description: "Check whether there are spaces or one of the following special characters in the URL or file name: [a-zA-Z_0-9:-]"
        failureScore: -3
        pattern: ^[a-zA-Z_0-9&%\?\./:\-]+$
      - id: Q-3.3
        description: The image must be at least 800 pixels wide and at least 600 pixels high.
        failureScore: -3
        skip: true
        dimension:
          minShortside: 600
          minLongside: 800
      - id: Q-3.4
        description: The preview image should be referenced by a hyperlink.
        successScore: 3
        pattern: ^https?://.*$
      - id: Q-3.5
        description:
          Check whether there is a MIME type for a preferred image file in the Content-Type attribute in the response
          header of the URL (see table "File types"). If the element contains a file name => check whether the file
          extension refers to an image file format preferred by the DDB.
        successScore: 3
        skip: true
        or:
        - pattern: ^.*\.(jpg|jpeg|jpe|jfif|png|tiff|tif|gif|svg|svgz|pdf)$
        - contentType: [image/jpeg, image/png, image/tiff, image/tiff-fx, image/gif, image/svg+xml, application/pdf]

  # Q-4	Link zum Digitalen Objekt
  # Mediendatei: none
  # Objekt im Medienviewer: none
  # Objekt im Kontext
  - name: url
    path: //rdf:RDF/edm:WebResource[@rdf:about = string(../ore:Aggregation[1]/edm:isShownAt/@rdf:resource)]/dcterms:rights/@rdf:resource
    rules:
      - id: Q-4.0
        hidden: true
        and:
        - minCount: 1
        - minLength: 1
      - id: Q-4.x
        hidden: true
        or:
        - maxCount: 0
        - and:
          - minCount: 1
          - minLength: 1
          - pattern: ^[a-zA-Z_0-9:/\.\-]+$
      - id: Q-4.1
        description: Check whether the data record contains either an element for the media file, the object in the media viewer or the object in the context (see table "Mapping the DDB elements"). If yes => check whether the corresponding element contains a value. If it is an object in the media viewer or an object in the context => check whether the value begins with http:// or https://.
        failureScore: -9
        and:
        - minCount: 1
        - minLength: 1
        - pattern: ^https?://.*$
      - id: Q-4.2
        description: Media files must be delivered in a format supported by the DDB.
        skip: true
        failureScore: -3
        and:
        - minCount: 1
        - minLength: 1
        - pattern: ^https?://.*$
        - contentType:
          - image/jpeg
          - image/png
          - image/tiff
          - image/tiff-fx
          - image/gif
          - image/svg+xml
          - application/pdf
          - audio/mpeg
          - video/mp4
          - video/webm
          - application/vnd.openxmlformats-officedocument.wordprocessingml.document
          - text/plain
          - text/richtext
          - text/rtf
          - video/x-msvideo
          - video/x-flv
          - video/quicktime
          - video/x-ms-wmv
          - video/mpeg
          - audio/x-mpeg
          - audio/mp4
      - id: Q-4.3
        description: Check whether there are spaces or impermissible special characters in the URL or in the file name (in the case of a media file that is not referenced by a URL).
        failureScore: -9
        dependencies: [Q-3.x, Q-4.x]
        # pattern: ^[a-zA-Z_0-9:/\.\-]+$
      - id: Q-4.4
        description: Check whether the data record contains a media file (see table "Mapping the DDB elements"). If so => check whether these elements contain a value.
        successScore: 6
        dependencies: [Q-3.0, Q-4.0]
      - id: Q-4.5
        description: Check whether the data record contains an object in context (see table "Mapping the DDB elements"). If so => check whether this element contain a value.
        successScore: 3
        dependencies: [Q-3.0, Q-4.0]
      - id: Q-4.6
        description: The data record contains a link to an object in the media viewer.
        successScore: 3
        dependencies: [Q-4.0]

  # TODO 4.6

  # Q-5	Rechtsstatus für das Digitale Objekt
  - name: rights
    path: rdf:RDF/edm:WebResource/edm:rights/@rdf:resource
    rules:
      - id: Q-5.1
        description: Check whether an element for the legal status is available in the data record (see table "Mapping the DDB elements"). If yes => check whether the element contains a value
        failureScore: -9
        and:
        - minCount: 1
        - minLength: 1
      - id: Q-5.2
        description: Check whether an http-URI for a license or a rights notice from the DDB license basket is referenced in the element for the legal status (see table "DDB license basket")
        failureScore: -9
        and:
        - minCount: 1
        - in:
          - http://creativecommons.org/licenses/by/3.0/de/
          - http://creativecommons.org/licenses/by/4.0/
          - http://creativecommons.org/licenses/by-sa/3.0/de/
          - http://creativecommons.org/licenses/by-sa/4.0/
          - http://creativecommons.org/licenses/by-nd/3.0/de/
          - http://creativecommons.org/licenses/by-nd/4.0/
          - http://creativecommons.org/licenses/by-nc/3.0/de/
          - http://creativecommons.org/licenses/by-nc/4.0/
          - http://creativecommons.org/licenses/by-nc-sa/3.0/de/
          - http://creativecommons.org/licenses/by-nc-sa/4.0/
          - http://creativecommons.org/licenses/by-nc-nd/3.0/de/
          - http://creativecommons.org/licenses/by-nc-nd/4.0/
          - http://creativecommons.org/publicdomain/mark/1.0/
          - http://creativecommons.org/publicdomain/zero/1.0/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-fz/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-ez/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/unbekannt/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/vw/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/nug-kkn/
          - http://rightsstatements.org/vocab/InC/1.0/
          - http://rightsstatements.org/vocab/InC-OW-EU/1.0/
          - http://rightsstatements.org/vocab/CNE/1.0/
          - http://rightsstatements.org/vocab/NoC-NC/1.0/
          - http://rightsstatements.org/vocab/InC-EDU/1.0/
          - http://rightsstatements.org/vocab/NoC-OKLR/1.0/
      # - id: Q-5.3
      #   description: The legal status must be specified for each media file referenced in the data set.
      #   failureScore: -3
      - id: Q-5.4
        description: Check whether an http-URI is specified for an open license or for an open license with name (see table "DDB license basket")
        successScore: 6
        and:
        - minCount: 1
        - in:
          - http://creativecommons.org/publicdomain/mark/1.0/
          - http://creativecommons.org/publicdomain/zero/1.0/
          - http://creativecommons.org/licenses/by/3.0/de/
          - http://creativecommons.org/licenses/by/4.0/
          - http://creativecommons.org/licenses/by-sa/3.0/de/
          - http://creativecommons.org/licenses/by-sa/4.0/
          - http://creativecommons.org/licenses/by-nd/3.0/de/
          - http://creativecommons.org/licenses/by-nd/4.0/
          - http://creativecommons.org/licenses/by-nc/3.0/de/
          - http://creativecommons.org/licenses/by-nc/4.0/
          - http://creativecommons.org/licenses/by-nc-sa/3.0/de/
          - http://creativecommons.org/licenses/by-nc-sa/4.0/
          - http://creativecommons.org/licenses/by-nc-nd/3.0/de/
          - http://creativecommons.org/licenses/by-nc-nd/4.0/"
      - id: Q-5.5
        description: Check whether an http-URI is specified for a rights notice with restricted use (see table "DDB license basket"). Check whether an http-URI is specified for a rights notice with the possibility of use on request (see table "DDB license basket")
        successScore: 3
        and:
        - minCount: 1
        - in:
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/vw/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/nug-kkn/
          - http://rightsstatements.org/vocab/InC-OW-EU/1.0/
          - http://rightsstatements.org/vocab/CNE/1.0/
          - http://rightsstatements.org/vocab/NoC-NC/1.0/
          - http://rightsstatements.org/vocab/InC-EDU/1.0/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-fz/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-ez/
          - http://www.deutsche-digitale-bibliothek.de/lizenzen/unbekannt/
          - http://rightsstatements.org/vocab/InC/1.0/
          - http://rightsstatements.org/vocab/NoC-OKLR/1.0/
#      - id: Q-5.6
#        description: A standardized notice of rights is used. The digital object may be used with restrictions.
#        in:
#        - http://www.deutsche-digitale-bibliothek.de/lizenzen/vw/
#        - http://www.deutsche-digitale-bibliothek.de/lizenzen/nug-kkn/
#        - http://rightsstatements.org/vocab/InC-OW-EU/1.0/
#        - http://rightsstatements.org/vocab/CNE/1.0/
#        - http://rightsstatements.org/vocab/NoC-NC/1.0/
#        - http://rightsstatements.org/vocab/InC-EDU/1.0/
#      - id: Q-5.7
#        description: A standardized notice of rights is used. The usage rights must be inquired about.
#        in:
#        - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-fz/
#        - http://www.deutsche-digitale-bibliothek.de/lizenzen/rv-ez/
#        - http://www.deutsche-digitale-bibliothek.de/lizenzen/unbekannt/
#        - http://rightsstatements.org/vocab/InC/1.0/
#        - http://rightsstatements.org/vocab/NoC-OKLR/1.0/

  # Q-6 Objekttitel
  - name: dc:title
    path: rdf:RDF/edm:ProvidedCHO/dc:title
    indexField: dc_title
    rules:
      - id: Q-6.1
        description: Check whether an element for the object title is available in the data record (see table "Mapping the DDB elements"). If yes => check whether the element contains a value.
        failureScore: -9
        and:
        - minCount: 1
        - pattern: ^.+$
      - id: Q-6.2
        description: Check whether the same object title occurs more than once in a data set or in several data sets
        failureScore: -6
        unique: true
      - id: Q-6.3
        description: Check whether there are fewer than three characters in the object title.
        failureScore: -3
        minLength: 3
      - id: Q-6.4
        description: Comparison of the values in the object title element with a predefined list of undesired values. This list must first be created. If necessary, the output lists for 6.2 and 6.3.
        failureScore: -3
        not:
          - in:
            - "?"
            - "ohne Title"
            - "unbekannter Titel"
      - id: Q-6.5
        description: Check whether the same string is contained in the element for the object title and the object type
        failureScore: -3
        not:
        - equals: Objekttyp_Bezeichnung

  # Q-7 Objekttyp
  - name: Objekttyp
    path: rdf:RDF/edm:ProvidedCHO/edm:hasType
    rules:
      - id: Q-7.1
        description: There must be at least one preferred designation for the object type in the data record.
        failureScore: -9
        minCount: 1
        allowEmptyInstances: true

      # - id: Q-7.4
      #   description: It is a specific object type designation and not an object description or object classification.
      #   failureScore: -3
      #   maxWords: 2

  # TODO: 7.2

  # Q-7 Objekttyp (URI)
  - name: Objekttyp_URI
    path: rdf:RDF/edm:ProvidedCHO/edm:hasType/@rdf:resource
    rules:
      - id: Q-7.5
        description: If there is an http-URI for the object type => check whether the URI begins with the namespace "http://d-nb.info/gnd/" or "http://vocab.getty.edu/aat/". If there is no http-URI for the object type => check whether the attribute for the source of the object type term contains the value "AAT", "gnd", "GND", "gnd-music" or "gnd-content".
        successScore: 6
        or:
        - and:
          - pattern: ^http.*$
          - pattern: ^http://(d-nb.info/gnd/|vocab.getty.edu/aat/).*$
        - and:
          - not:
            - pattern: ^http.*$
          - in: [AAT, gnd, GND, gnd-music, gnd-content]
      - id: Q-7.6
        description: Check whether the value in the element for the URI of the object type begins with http:// or https://. If yes => check whether the URI begins with a namespace for a LOD vocabulary accepted by the DDB (see Sect.
        successScore: 6
        pattern: ^https?://(vocab.getty.edu/aat/|vocab.getty.edu/ulan/|vocab.getty.edu/tgn/|viaf.org/viaf/|sws.geonames.org/|iconclass.org/|d-nb.info/gnd|www.imj.org.il/imagine/thesaurus/objects/|id.loc.gov/authorities/subjects/|data.europeana.eu/concept/loc|data.europeana.eu/concept/soundgenres/|udcdata.info/rdf/|vocabularies.unesco.org/thesaurus/|finto.fi/yso/en/|www.wikidata.org/entity/|thesaurus.europeanafashion.eu/thesaurus/|www.mimo-db.eu/).*$
      - id: Q-7.7
        description: Check whether the URI starts with "http://d-nb.info/gnd/" or "http://vocab.getty.edu/aat/".
        successScore: 9
        pattern: ^http://(d-nb.info/gnd/|vocab.getty.edu/aat/).*$
      - id: Q-7.8
        description: Check whether the URI starts with "http://vocab.getty.edu/aat/Q".
        successScore: 6
        pattern: ^http://vocab.getty.edu/aat/Q.*$

  # Objekttyp (Bezeichnung)
  - name: Objekttyp_Bezeichnung
    path: rdf:RDF/skos:Concept[@rdf:about = string(../edm:ProvidedCHO/edm:hasType/@rdf:resource)]/skos:prefLabel

  # Objekttyp (Sprache der Bezeichnung)
  - name: Objekttyp_Sprache
    path: rdf:RDF/skos:Concept[@rdf:about = string(../edm:ProvidedCHO/edm:hasType/@rdf:resource)]/skos:prefLabel/@xml:lang
    # rules:
    #   - id: Q-7.2
    #     description:
    #       Check whether the language of the designation is identified by an attribute.
    #       If yes => test, the ISO code "de", "deu" or "ger" is specified in the language attribute.
    #     and:
    #       - minCount: 1
    #       - in: [de, deu, ger]

# Objekttyp (Quellenangabe) -- it is not existing in DDB EDM
 #- name: dc_type_source
 #  path: oai:record/dc:type/@resource
 #  rules:
 #    - id: Q-7.3
 #      description: The object type must come from a controlled vocabulary.
 #      failureScore: -6
 #      pattern: ^https?://(vocab.getty.edu/aat/|vocab.getty.edu/ulan/|vocab.getty.edu/tgn/|viaf.org/viaf/|sws.geonames.org/|iconclass.org/|d-nb.info/gnd|www.imj.org.il/imagine/thesaurus/objects/|id.loc.gov/authorities/subjects/|data.europeana.eu/concept/loc|data.europeana.eu/concept/soundgenres/|udcdata.info/rdf/|vocabularies.unesco.org/thesaurus/|finto.fi/yso/en/|www.wikidata.org/entity/|thesaurus.europeanafashion.eu/thesaurus/|www.mimo-db.eu/).*$

namespaces:
  doc: http://www.lyncode.com/xoai
  foaf: http://xmlns.com/foaf/0.1/
  europeana: http://www.europeana.eu/schemas/ese/
  dcterms: http://purl.org/dc/terms/
  dc: http://purl.org/dc/elements/1.1/
  oai: http://www.openarchives.org/OAI/2.0/
  rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
  RDF: http://www.w3.org/1999/02/22FrdfFsyntaxFns#
  crm: http://www.cidoc-crm.org/cidoc-crm/
  ddb: http://www.deutsche-digitale-bibliothek.de/edm/
  edm: http://www.europeana.eu/schemas/edm/
  marcrel: http://id.loc.gov/vocabulary/relators/
  ore: http://www.openarchives.org/ore/terms/
  owl: http://www.w3.org/2002/07/owl#
  rdaGr2: http://RDVocab.info/ElementsGr2/
  skos: http://www.w3.org/2004/02/skos/core#
  wgs84_pos: http://www.w3.org/2003/01/geo/wgs84_pos#
